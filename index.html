<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Provider Map</title>

    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
      }
      #map {
        height: 100%;
        width: 100%;
      }

      /* Legend box */
      .legend {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: white;
        padding: 12px;
        border-radius: 6px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
      }
      .legend-color {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-right: 8px;
        border: 2px solid #fff;
      }
    </style>

    <!-- Load Google Maps JS API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA3kRQCQIWUxnsE1b0__QSyCfFKkHwN8A"></script>
  </head>

  <body>
    <div id="map"></div>

    <!-- Legend -->
    <div class="legend" id="legend">
      <div class="legend-item">
        <div class="legend-color" style="background:#1f77b4;"></div> Main Line
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background:#ff7f0e;"></div> Jefferson
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background:#2ca02c;"></div> St. Luke's
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background:#d62728;"></div> Tandigm
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background:#9467bd;"></div> UPenn
      </div>
    </div>

    <script>
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 9,
          center: { lat: 40.0, lng: -75.2 },
          mapId: "providerMap"
        });

        // Color mapping by affiliation
        function getColor(aff) {
          switch (aff) {
            case "Main Line": return "#1f77b4";
            case "Jefferson": return "#ff7f0e";
            case "St. Luke's": return "#2ca02c";
            case "Tandigm": return "#d62728";
            case "UPenn": return "#9467bd";
            default: return "#555";
          }
        }

        // Load GeoJSON
        fetch("data.geojson")
          .then(response => response.json())
          .then(data => {
            data.features.forEach(feature => {
              const coords = feature.geometry.coordinates;
              const props = feature.properties;

              const affiliation = props["Affiliation"];
              const members = props["Member Attribution"];

              // Circle size scale
              const size = Math.max(8, Math.sqrt(members) * 1.4);

              const color = getColor(affiliation);

              const marker = new google.maps.Circle({
                strokeColor: "#ffffff",
                strokeWeight: 2,
                fillColor: color,
                fillOpacity: 0.75,
                center: { lat: coords[1], lng: coords[0] },
                radius: size * 20,
                map
              });

              const info = new google.maps.InfoWindow({
                content: `
                  <strong>${props["Provider / Facility"]}</strong><br>
                  Affiliation: ${affiliation}<br>
                  Members: ${members}<br>
                  Address: ${props.Address}, ${props.City}, ${props.State} ${props.Zip}
                `
              });

              marker.addListener("click", () => {
                info.open({ anchor: marker, map });
              });
            });
          })
          .catch(err => {
            alert("Could not load data.geojson. Check file name or format.");
            console.error(err);
          });
      }

      window.onload = initMap;
    </script>
  </body>
</html>
